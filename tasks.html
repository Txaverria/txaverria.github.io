<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tasks</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <link rel="icon" type="image/x-icon" href="img/tasks/favicon.png" />

    <style>
      body {
        background-color: #1e1e2e;
        color: #c6d0f5;
        font-family: "Arimo", sans-serif;
        margin: 20px;
      }
      h1 {
        margin: 20px 0;
      }

      .tasks-container {
        display: flex;
        justify-content: space-between;
        gap: 20px;
      }

      .task-column {
        flex: 1;
        padding: 20px;
        height: 100%;
      }

      #weekly-tasks-container, #daily-tasks-container {
        margin-bottom: 10px;
      }

      .task-column:last-child {
        flex: 0.5;
      }

      .task-column h2 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }

      .task {
        display: flex;
        align-items: flex-start;
        font-size: 1.5rem;
        position: relative;
        text-transform: lowercase;
        gap: 10px;
      }

      .task input[type="checkbox"] {
        margin-top: 12px;
      }

      .task.completed {
        color: #f7e4f7;
        text-decoration: line-through;
      }
      .btn {
        background-color: #44475a;
        color: #c6d0f5;
        border: none;
      }
      .btn:hover {
        background-color: #f7e4f7;
        color: #44475a;
      }

      .task-span {
        flex-grow: 1;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .trash-icon {
        cursor: pointer;
        margin-top: 4px;
        color: #c6d0f5;
        visibility: hidden;
        opacity: 0;
      }

      .task:hover .trash-icon {
        visibility: visible;
        opacity: 1;
      }

      .trash-icon:hover {
        color: #ff6b6b;
      }
      #editable-task {
        color: #c6d0f5;
        outline: none;
        border: none;
        background: none;
        font-family: inherit;
        font-size: inherit;
        padding: 5px;
        width: 100%;
        font-size: 1.5rem;
        text-transform: lowercase;
      }
      #editable-task::placeholder {
        color: #757575;
      }
      #editable-task:hover::placeholder {
        color: #f7e4f7;
      }

      .task-input {
        background-color: #1e1e2e;
        color: #f7e4f7;
        width: 100%;
        border: 0px solid #c6d0f5;
        text-transform: lowercase;
        resize: none;
        overflow: hidden;
        font-family: inherit;
        outline: none;
        padding: 0;
      }

      @media (max-width: 768px) {
        .tasks-container {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <h1 class="fw-bold">TASKS</h1>

    <div class="tasks-container">
      <div class="task-column">
        <h2>WEEKLY</h2>
        <div id="weekly-tasks-container"></div>
        <input id="weekly-editable-task" class="task-input" type="text" placeholder="+ Type your weekly task and press Enter" />
      </div>

      <div class="task-column">
        <h2>DAILY</h2>
        <div id="daily-tasks-container"></div>
        <input id="daily-editable-task" class="task-input" type="text" placeholder="+ Type your daily task and press Enter" />
      </div>
    </div>

    <script>
      const weeklyTasksContainer = document.getElementById("weekly-tasks-container");
      const weeklyEditableTask = document.getElementById("weekly-editable-task");
      const dailyTasksContainer = document.getElementById("daily-tasks-container");
      const dailyEditableTask = document.getElementById("daily-editable-task");

      // Load tasks from localStorage
      function loadTasks(container, key) {
        const tasks = JSON.parse(localStorage.getItem(key)) || [];
        tasks.forEach((task) => {
          createTaskElement(container, task.text, task.completed);
        });
      }

      // Save tasks to localStorage
      function saveTasks(container, key) {
        const tasks = [];
        container.querySelectorAll(".task").forEach((taskDiv) => {
          const text = taskDiv.querySelector("span").textContent;
          const completed = taskDiv.querySelector("input[type='checkbox']").checked;
          tasks.push({ text, completed });
        });
        localStorage.setItem(key, JSON.stringify(tasks));
      }

      // Create task element
      function createTaskElement(container, taskText, isCompleted = false) {
        const taskDiv = document.createElement("div");
        taskDiv.className = "task";
        if (isCompleted) {
          taskDiv.classList.add("completed");
        }

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = isCompleted;
        checkbox.addEventListener("change", () => {
          taskDiv.classList.toggle("completed", checkbox.checked);
          saveTasks(container, container.id);
        });

        const taskLabel = document.createElement("span");
        taskLabel.textContent = taskText;
        taskLabel.className = "task-span";
        taskLabel.addEventListener("click", () => {
          const inputField = document.createElement("textarea");
          inputField.rows = "1";
          var newHeight = taskLabel.scrollHeight;
          inputField.value = taskLabel.textContent;
          inputField.style.height = `${newHeight}px`;
          inputField.className = "task-input";
          taskDiv.replaceChild(inputField, taskLabel);

          inputField.focus();
          inputField.addEventListener("blur", () => {
            const newText = inputField.value.trim();
            if (newText) {
              taskLabel.textContent = newText;
              taskDiv.replaceChild(taskLabel, inputField);
            } else {
              container.removeChild(taskDiv);
            }
            saveTasks(container, container.id);
          });

          inputField.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
              inputField.blur();
            }
          });
        });

        const trashIcon = document.createElement("span");
        trashIcon.innerHTML = "<i class='bi bi-x-lg'></i>";
        trashIcon.className = "trash-icon";
        trashIcon.addEventListener("click", () => {
          container.removeChild(taskDiv);
          saveTasks(container, container.id);
        });

        taskDiv.appendChild(checkbox);
        taskDiv.appendChild(taskLabel);
        taskDiv.appendChild(trashIcon);
        container.appendChild(taskDiv);

        saveTasks(container, container.id);
      }

      weeklyEditableTask.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          const taskText = weeklyEditableTask.value.trim();
          if (taskText) {
            createTaskElement(weeklyTasksContainer, taskText);
            weeklyEditableTask.value = "";
          }
        }
      });

      dailyEditableTask.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          const taskText = dailyEditableTask.value.trim();
          if (taskText) {
            createTaskElement(dailyTasksContainer, taskText);
            dailyEditableTask.value = "";
          }
        }
      });

      // Reset daily tasks to not completed at midnight
      function resetDailyTasks() {
        const tasks = JSON.parse(localStorage.getItem("daily-tasks-container")) || [];
        tasks.forEach((task) => (task.completed = false));
        localStorage.setItem("daily-tasks-container", JSON.stringify(tasks));
        dailyTasksContainer.querySelectorAll(".task").forEach((taskDiv) => {
          const checkbox = taskDiv.querySelector("input[type='checkbox']");
          checkbox.checked = false;
          taskDiv.classList.remove("completed");
        });
      }

      setInterval(() => {
        const now = new Date();
        if (now.getHours() === 0 && now.getMinutes() === 0) {
          resetDailyTasks();
        }
      }, 60000); // Check every minute

      loadTasks(weeklyTasksContainer, "weekly-tasks-container");
      loadTasks(dailyTasksContainer, "daily-tasks-container");
    </script>
  </body>
</html>
