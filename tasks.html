<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tasks</title>

    <link href="https://fonts.googleapis.com/css2?family=Arimo:wght@400;700&display=swap" rel="stylesheet" />
    <link rel="icon" href="img/tasks/favicon.png" type="image/x-icon" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

    <style>
      body {
        background-color: #1e1e2e;
        color: #c6d0f5;
        font-family: "Arimo", sans-serif;
        margin: 20px;
      }
      h1 {
        margin: 20px 0;
      }
      .tasks-container {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        flex-wrap: wrap;
      }
      .task-column {
        flex: 0.6;
      }
      .task-column:last-child {
        flex: 0.4;
      }
      .task-column h2 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }
      .task {
        display: flex;
        align-items: flex-start;
        font-size: 1.5rem;
        gap: 10px;
        margin-bottom: 5px;
      }
      .task input[type="checkbox"] {
        margin-top: 6px;
      }

      .task input[type="checkbox"]:checked {
        accent-color: #a6e3a1 !important;
      }

      .task.completed textarea {
        color: #a6e3a1;
        text-decoration: line-through;
      }

      textarea {
        background: none;
        border: none;
        width: 100%;
        font-family: inherit;
        color: #c6d0f5;
        resize: none;
      }
      .trash-icon {
        cursor: pointer;
        visibility: hidden;
      }
      .task:hover .trash-icon {
        visibility: visible;
      }

      .trash-icon:hover {
        color: #c6d0f5;
      }

      .trash-icon:hover {
        color: #f38ba8;
      }

      .task-input {
        background: none;
        width: 100%;
        border: 0px solid #c6d0f5;
        text-transform: lowercase;
        resize: none;
        overflow: hidden;
        font-family: inherit;
        outline: none;
        padding: 0;
        font-size: 1.5rem;
      }

      .task-input:focus {
        color: #f7e4f7 !important;
      }

      #weekly-tasks-container,
      #daily-tasks-container {
        margin-bottom: 10px;
      }

      .task-input#daily-task-input,
      .task-input#weekly-task-input {
        color: #6c7086 !important;
      }

      @media (max-width: 768px) {
        .tasks-container {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <h1>TASKS</h1>
    <div class="tasks-container">
      <div class="task-column">
        <h2>WEEKLY</h2>
        <div id="weekly-tasks-container"></div>
        <input id="weekly-task-input" class="task-input" type="text" placeholder="+ Type weekly task and press Enter" />
      </div>
      <div class="task-column">
        <h2>DAILY</h2>
        <div id="daily-tasks-container"></div>
        <input id="daily-task-input" class="task-input" type="text" placeholder="+ Type daily task and press Enter" />
      </div>
    </div>

    <script>
      const weeklyTasksContainer = document.getElementById("weekly-tasks-container");
      const dailyTasksContainer = document.getElementById("daily-tasks-container");

      function loadTasks(container, key) {
        const tasks = JSON.parse(localStorage.getItem(key)) || [];
        tasks.forEach(({ text, completed }) => createTaskElement(container, text, completed));
      }

      function saveTasks(container, key) {
        const tasks = [...container.querySelectorAll(".task")].map((taskDiv) => ({
          text: taskDiv.querySelector("textarea").value,
          completed: taskDiv.querySelector("input[type='checkbox']").checked,
        }));
        localStorage.setItem(key, JSON.stringify(tasks));
      }

      function createTaskElement(container, text, completed = false) {
        const taskDiv = document.createElement("div");
        taskDiv.className = `task ${completed ? "completed" : ""}`;

        taskDiv.innerHTML = `
          <input type="checkbox" ${completed ? "checked" : ""}>
          <textarea class="task-input" rows="1">${text}</textarea>
          <span class="trash-icon">
            <i class="bi bi-x-lg"></i>
          </span>
        `;

        const taskInput = taskDiv.querySelector(".task-input");

        // Function to dynamically adjust height based on zoom level
        const adjustHeight = () => {
          taskInput.style.height = "auto"; // Reset height
          taskInput.style.height = `${taskInput.scrollHeight}px`; // Adjust height
        };

        // Adjust height immediately after appending to the DOM
        requestAnimationFrame(adjustHeight);

        // Add event listener to adjust height on input
        taskInput.addEventListener("input", adjustHeight);

        // Save tasks when the textarea loses focus
        taskInput.addEventListener("blur", () => saveTasks(container, container.id));

        // Toggle completed class on checkbox change
        taskDiv.querySelector("input").addEventListener("change", () => {
          taskDiv.classList.toggle("completed");
          saveTasks(container, container.id);
        });

        // Remove task on clicking trash icon
        taskDiv.querySelector(".trash-icon").addEventListener("click", () => {
          taskDiv.remove();
          saveTasks(container, container.id);
        });

        // Append the task to the container
        container.appendChild(taskDiv);

        // Ensure all tasks are saved to localStorage
        saveTasks(container, container.id);

        // Recalculate height on window resize (zoom changes trigger this)
        window.addEventListener("resize", adjustHeight);
      }

      function handleInput(event, container) {
        if (event.key === "Enter" && event.target.value.trim()) {
          createTaskElement(container, event.target.value.trim());
          event.target.value = "";
        }
      }

      document.getElementById("weekly-task-input").addEventListener("keydown", (e) => handleInput(e, weeklyTasksContainer));
      document.getElementById("daily-task-input").addEventListener("keydown", (e) => handleInput(e, dailyTasksContainer));

      loadTasks(weeklyTasksContainer, "weekly-tasks-container");
      loadTasks(dailyTasksContainer, "daily-tasks-container");
    </script>
  </body>
</html>
